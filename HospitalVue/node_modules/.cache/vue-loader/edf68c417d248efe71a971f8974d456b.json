{"remainingRequest":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Strive\\HOS\\HospitalVue\\src\\views\\DealOrder.vue?vue&type=style&index=0&id=5a6a5478&lang=scss&scoped=true&","dependencies":[{"path":"E:\\Strive\\HOS\\HospitalVue\\src\\views\\DealOrder.vue","mtime":1741752022541},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\css-loader\\dist\\cjs.js","mtime":1689001367870},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1689001369658},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\postcss-loader\\src\\index.js","mtime":1689001368637},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1689001367224},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1689001367240},{"path":"E:\\Strive\\HOS\\HospitalVue\\node_modules\\vue-loader\\lib\\index.js","mtime":1689001369023}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci8qIOS4u+iJsuiwgyAqLwokcHJpbWFyeS1jb2xvcjogIzQwOUVGRjsKJHN1Y2Nlc3MtY29sb3I6ICM2N0MyM0E7CiRkYW5nZXItY29sb3I6ICNGNTZDNkM7CiRpbmZvLWNvbG9yOiAjOTA5Mzk5OwoKLyog5biD5bGA5LyY5YyWICovCi5lbC1jYXJkIHsKICBtYXJnaW46IDIwcHg7CiAgYm94LXNoYWRvdzogMCAycHggMTJweCByZ2JhKDAsMCwwLDAuMSk7CgogIC5lbC1yb3cgewogICAgbWFyZ2luOiAxNXB4IDA7CiAgICBwYWRkaW5nOiAxMnB4OwogICAgYmFja2dyb3VuZDogI2Y1ZjdmYTsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKCiAgICAuZWwtY29sIHsKICAgICAgZGlzcGxheTogZmxleDsKICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsKCiAgICAgIC5vcmRlcklucHV0IHsKICAgICAgICB3aWR0aDogMjIwcHg7CiAgICAgICAgbWFyZ2luLWxlZnQ6IDEwcHg7CgogICAgICAgICYuZWwtaW5wdXQuaXMtZGlzYWJsZWQgLmVsLWlucHV0X19pbm5lciB7CiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjVmN2ZhOwogICAgICAgICAgY29sb3I6ICM2MDYyNjY7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQp9CgovKiDooajmoLzkvJjljJYgKi8KLmVsLXRhYmxlIHsKICBtYXJnaW46IDIwcHggMDsKCiAgJjo6YmVmb3JlIHsKICAgIGhlaWdodDogMDsgLy8g5Y676Zmk6buY6K6k6L655qGGCiAgfQoKICB0aCB7CiAgICBiYWNrZ3JvdW5kOiAjZjhmOWZhOwogICAgZm9udC13ZWlnaHQ6IDYwMDsKICAgIGNvbG9yOiAjMzAzMTMzOwogIH0KCiAgLmVsLWJ1dHRvbiB7CiAgICBwYWRkaW5nOiA3cHggMTJweDsKCiAgICAmKy5lbC1idXR0b24gewogICAgICBtYXJnaW4tbGVmdDogOHB4OwogICAgfQoKICAgIGkgewogICAgICBtYXJnaW4tcmlnaHQ6IDVweDsKICAgIH0KICB9Cn0KCi8qIOWIhumhteagt+W8jyAqLwouZWwtcGFnaW5hdGlvbiB7CiAgbWFyZ2luOiAyMHB4IDA7CiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsKfQoKLyog5Y+z5L6n6Z2i5p2/ICovCi5kcnVnUmlndGggewogIHBhZGRpbmctbGVmdDogMjBweDsKCiAgLnJpZ3RoVGFibGUgewogICAgaGVpZ2h0OiA0MDBweDsKICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICBib3JkZXI6IDFweCBzb2xpZCAjZWJlZWY1OwoKICAgICsgLmVsLXRhZyB7CiAgICAgIG1hcmdpbi10b3A6IDE1cHg7CiAgICAgIHBhZGRpbmc6IDAgMTVweDsKICAgICAgaGVpZ2h0OiAzMnB4OwogICAgICBsaW5lLWhlaWdodDogMzJweDsKICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICBiYWNrZ3JvdW5kOiAjZjVmN2ZhOwogICAgICBjb2xvcjogJHByaW1hcnktY29sb3I7CiAgICB9CiAgfQp9CgovKiDlr7nor53moYbkvJjljJYgKi8KLmVsLWRpYWxvZyB7CiAgYm9yZGVyLXJhZGl1czogOHB4OwoKICAmX19oZWFkZXIgewogICAgcGFkZGluZzogMjBweDsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWJlZWY1OwogIH0KCiAgJl9fYm9keSB7CiAgICBwYWRkaW5nOiAyMHB4OwoKICAgIC5lbC10ZXh0YXJlYV9faW5uZXIgewogICAgICBtaW4taGVpZ2h0OiAxNTBweDsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgICBsaW5lLWhlaWdodDogMS41OwogICAgfQogIH0KCiAgJl9fZm9vdGVyIHsKICAgIHBhZGRpbmc6IDE1cHggMjBweDsKICAgIHRleHQtYWxpZ246IHJpZ2h0OwoKICAgIC5lbC1idXR0b24gewogICAgICBwYWRkaW5nOiAxMHB4IDIwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIH0KICB9Cn0KCi8qIOWTjeW6lOW8j+S8mOWMliAqLwpAbWVkaWEgKG1heC13aWR0aDogMTIwMHB4KSB7CiAgLmVsLWNvbCB7CiAgICBtYXJnaW4tYm90dG9tOiAxNXB4OwoKICAgICYuZHJ1Z1JpZ3RoIHsKICAgICAgcGFkZGluZy1sZWZ0OiAwOwogICAgICBtYXJnaW4tdG9wOiAyMHB4OwogICAgfQogIH0KCiAgLnJpZ3RoVGFibGUgewogICAgaGVpZ2h0OiBhdXRvICFpbXBvcnRhbnQ7CiAgfQp9Cg=="},{"version":3,"sources":["DealOrder.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA","file":"DealOrder.vue","sourceRoot":"src/views","sourcesContent":["<style lang=\"scss\" scoped>\n/* 主色调 */\n$primary-color: #409EFF;\n$success-color: #67C23A;\n$danger-color: #F56C6C;\n$info-color: #909399;\n\n/* 布局优化 */\n.el-card {\n  margin: 20px;\n  box-shadow: 0 2px 12px rgba(0,0,0,0.1);\n\n  .el-row {\n    margin: 15px 0;\n    padding: 12px;\n    background: #f5f7fa;\n    border-radius: 4px;\n\n    .el-col {\n      display: flex;\n      align-items: center;\n\n      .orderInput {\n        width: 220px;\n        margin-left: 10px;\n\n        &.el-input.is-disabled .el-input__inner {\n          background-color: #f5f7fa;\n          color: #606266;\n        }\n      }\n    }\n  }\n}\n\n/* 表格优化 */\n.el-table {\n  margin: 20px 0;\n\n  &::before {\n    height: 0; // 去除默认边框\n  }\n\n  th {\n    background: #f8f9fa;\n    font-weight: 600;\n    color: #303133;\n  }\n\n  .el-button {\n    padding: 7px 12px;\n\n    &+.el-button {\n      margin-left: 8px;\n    }\n\n    i {\n      margin-right: 5px;\n    }\n  }\n}\n\n/* 分页样式 */\n.el-pagination {\n  margin: 20px 0;\n  justify-content: flex-end;\n}\n\n/* 右侧面板 */\n.drugRigth {\n  padding-left: 20px;\n\n  .rigthTable {\n    height: 400px;\n    overflow-y: auto;\n    border: 1px solid #ebeef5;\n\n    + .el-tag {\n      margin-top: 15px;\n      padding: 0 15px;\n      height: 32px;\n      line-height: 32px;\n      font-size: 16px;\n      background: #f5f7fa;\n      color: $primary-color;\n    }\n  }\n}\n\n/* 对话框优化 */\n.el-dialog {\n  border-radius: 8px;\n\n  &__header {\n    padding: 20px;\n    border-bottom: 1px solid #ebeef5;\n  }\n\n  &__body {\n    padding: 20px;\n\n    .el-textarea__inner {\n      min-height: 150px;\n      font-size: 14px;\n      line-height: 1.5;\n    }\n  }\n\n  &__footer {\n    padding: 15px 20px;\n    text-align: right;\n\n    .el-button {\n      padding: 10px 20px;\n      border-radius: 4px;\n    }\n  }\n}\n\n/* 响应式优化 */\n@media (max-width: 1200px) {\n  .el-col {\n    margin-bottom: 15px;\n\n    &.drugRigth {\n      padding-left: 0;\n      margin-top: 20px;\n    }\n  }\n\n  .rigthTable {\n    height: auto !important;\n  }\n}\n</style>\n\n<script>\nimport jwtDecode from \"jwt-decode\";\nimport { getToken } from \"@/utils/storage.js\";\nimport request from \"@/utils/request.js\";\nexport default {\n  name: \"dealOrder\",\n  data() {\n    return {\n      oId: 1,\n      pId: 1,\n      dId: 0,\n      pName: \"aa\",\n      pGender: \"as\",\n      pPhone: \"asd\",\n      dName: \"\",\n      drugData: [],\n      size: 4,\n      pageNumber: 1,\n      total: 3,\n      queryDrug: \"\",\n      drugBuyData: [],\n      drugTotalPrice: 0,\n      //病因\n      reason: \"\",\n      //项目表格数据\n      checkData: [],\n      queryCheck: \"\",\n      checkTotal: 3,\n      checkSize: 4,\n      checkPageNumber: 1,\n      checkTotalPrice: 0,\n      checkBuyData: [],\n      // 病因编写对话框显示参数\n      reasonFormVisible: false,\n    };\n  },\n  methods: {\n    //根据id减少药物数量\n    reduceDrugNumber(drId, usedNumber) {\n      request\n        .get(\"drug/reduceDrugNumber\", {\n          params: {\n            drId: drId,\n            usedNumber: usedNumber,\n          },\n        })\n        .then((res) => {\n          if (res.data.status !== 200) {\n            this.$message.error(\"药物数量不足！！\");\n          }\n        });\n    },\n    //点击提交按钮\n    submitClick() {\n      for (let i = 0; i < this.drugBuyData.length; i++) {\n        this.reduceDrugNumber(\n          this.drugBuyData[i].drId,\n          this.drugBuyData[i].drNum\n        );\n      }\n      let data = {\n        oId: this.dataPackage().oId,\n        pId: this.pId,\n        dId: this.dId,\n        oRecord: this.dataPackage().oRecord,\n        oDrug: this.dataPackage().oDrug,\n        oCheck: this.dataPackage().oCheck,\n        oTotalPrice: this.dataPackage().oTotalPrice,\n      };\n      request\n        .post(\"order/updateOrder\", data)\n        .then((res) => {\n          if (res.data.status !== 200) {\n            this.$message.error(\"请求信息错误\");\n            return;\n          }\n          this.$message.success(\"提交成功！请通知患者登录系统自助缴费！\");\n          this.$router.push(\"/orderToday\");\n          console.log(res.data);\n        })\n        .catch((err) => {\n          console.error(err);\n        });\n    },\n    //封装数据\n    dataPackage() {\n      let oDrug = \"\";\n      let oCheck = \"\";\n      let oTotalPrice = 0;\n      let oId = this.oId;\n      let oRecord = this.reason;\n      for (let i = 0; i < this.drugBuyData.length; i++) {\n        oDrug +=\n          this.drugBuyData[i].drName +\n          \"*\" +\n          this.drugBuyData[i].drPrice +\n          \"(元)*\" +\n          this.drugBuyData[i].drNum +\n          \" \";\n      }\n      for (let i = 0; i < this.checkBuyData.length; i++) {\n        oCheck +=\n          this.checkBuyData[i].chName +\n          \"*\" +\n          this.checkBuyData[i].chPrice +\n          \"(元) \";\n      }\n      oCheck += \" 项目总价\" + this.checkTotalPrice + \"元 \";\n      oDrug += \" 药物总价\" + this.drugTotalPrice + \"元 \";\n      oTotalPrice = this.checkTotalPrice + this.drugTotalPrice;\n      return { oId, oRecord, oDrug, oCheck, oTotalPrice };\n    },\n    //点击病因保存按钮\n    holdReason() {\n      this.reasonFormVisible = false;\n      this.$message.success(\"信息保存成功！\");\n    },\n    //打开病因编写对话框\n    openReason() {\n      this.reasonFormVisible = true;\n    },\n    //检查列表点击移除按钮\n    deleteCheck(chId) {\n      for (let i = 0; i < this.checkBuyData.length; i++) {\n        if (this.checkBuyData[i].chId === chId) {\n          this.checkTotalPrice -= this.checkBuyData[i].chPrice; //药物价格总计\n          this.checkBuyData.splice(i, 1); //！！！！！！删除数组中下标为i的元素\n        }\n      }\n    },\n    //检查列表点击增加按钮\n    addCheck(chId) {\n      request\n        .get(\"check/findCheck\", {\n          params: {\n            chId: chId,\n          },\n        })\n        .then((res) => {\n          if (res.data.status != 200) return this.$message.error(\"信息请求失败\");\n          //后端传过来的是对象，表格绑定的数组\n          this.checkBuyData.push({\n            chId: res.data.data.chId,\n            chPrice: res.data.data.chPrice,\n            chName: res.data.data.chName,\n          });\n          this.checkTotalPrice += res.data.data.chPrice; //药物价格总计\n          console.log(res.data.data);\n        });\n    },\n    //药物页面大小切换时触发\n    checkSizeChange(size) {\n      this.checkSize = size;\n      this.requestCheck();\n    },\n    //检查页数切换时触发\n    checkCurrentChange(num) {\n      this.checkPageNumber = num;\n      this.requestCheck();\n    },\n    //请求检查项目\n    requestCheck() {\n      request\n        .get(\"check/findAllChecks\", {\n          params: {\n            size: this.checkSize,\n            pageNumber: this.checkPageNumber,\n            query: this.queryCheck,\n          },\n        })\n        .then((res) => {\n          if (res.data.status != 200) this.$message.error(\"获取信息失败\");\n          this.checkData = res.data.data.checks;\n          this.checkTotal = res.data.data.total;\n          console.log(res);\n        });\n    },\n    /**\n     * 此处逻辑较复杂，容易出现错误\n     */\n    //药物列表点击移除按钮\n    deleteDrug(drId) {\n      for (let i = 0; i < this.drugBuyData.length; i++) {\n        if (this.drugBuyData[i].drId === drId) {\n          for (let j = 0; j < this.drugData.length; j++) {\n            if (this.drugData[j].drId === drId) this.drugData[j].drNumber += 1;\n          }\n          this.drugBuyData[i].drNum -= 1;\n          this.drugBuyData[i].drSum =\n            this.drugBuyData[i].drPrice * this.drugBuyData[i].drNum;\n          this.drugTotalPrice -= this.drugBuyData[i].drPrice; //药物价格总计\n          if (this.drugBuyData[i].drNum === 0) this.drugBuyData.splice(i, 1); //！！！！！！删除数组中下标为i的元素\n        }\n      }\n    },\n    //药物列表点击增加按钮\n    addDrug(drId) {\n      request\n        .get(\"drug/findDrug\", {\n          params: {\n            drId: drId,\n          },\n        })\n        .then((res) => {\n          if (res.data.status != 200) return this.$message.error(\"信息请求失败\");\n          //后端传过来的是对象，表格绑定的数组\n          for (let i = 0; i < this.drugBuyData.length; i++) {\n            if (this.drugBuyData[i].drId === res.data.data.drId) {\n              for (let j = 0; j < this.drugData.length; j++) {\n                if (\n                  this.drugData[j].drId === res.data.data.drId &&\n                  this.drugData[j].drNumber > 0\n                ) {\n                  this.drugData[j].drNumber -= 1;\n                  this.drugBuyData[i].drNum += 1;\n                  this.drugBuyData[i].drSum =\n                    this.drugBuyData[i].drPrice * this.drugBuyData[i].drNum;\n                  this.drugTotalPrice += this.drugBuyData[i].drPrice; //药物价格总计\n                  //return;\n                }\n              }\n              return;\n            }\n          }\n          for (let j = 0; j < this.drugData.length; j++) {\n            if (\n              this.drugData[j].drId === res.data.data.drId &&\n              this.drugData[j].drNumber <= 0\n            )\n              return;\n          }\n          this.drugBuyData.push({\n            drId: res.data.data.drId,\n            drPrice: res.data.data.drPrice,\n            drName: res.data.data.drName,\n            drNum: 1,\n            drSum: res.data.data.drPrice,\n          });\n          for (let j = 0; j < this.drugData.length; j++) {\n            if (this.drugData[j].drId === res.data.data.drId)\n              this.drugData[j].drNumber -= 1;\n          }\n          this.drugTotalPrice += res.data.data.drPrice; //药物价格总计\n\n          console.log(res.data.data);\n        });\n    },\n    //药物页面大小切换时触发\n    handleSizeChange(size) {\n      this.size = size;\n      this.requestDrug();\n    },\n    //药物页数切换时触发\n    handleCurrentChange(num) {\n      this.pageNumber = num;\n      this.requestDrug();\n    },\n\n    //获取药物列表\n    requestDrug() {\n      request\n        .get(\"drug/findAllDrugs\", {\n          params: {\n            size: this.size,\n            pageNumber: this.pageNumber,\n            query: this.queryDrug,\n          },\n        })\n        .then((res) => {\n          if (res.data.status != 200) this.$message.error(\"获取信息失败\");\n          this.drugData = res.data.data.drugs;\n          this.total = res.data.data.total;\n\n          console.log(res);\n        });\n    },\n    //获取患者信息\n    requestPatient() {\n      request\n        .get(\"doctor/findPatientById\", {\n          params: {\n            pId: this.pId,\n          },\n        })\n        .then((res) => {\n          console.log(res);\n          if (res.data.status != 200) this.$message.error(\"获取信息失败\");\n          this.pName = res.data.data.pName;\n          this.pGender = res.data.data.pGender;\n          this.pPhone = res.data.data.pPhone;\n        });\n    },\n    //token解码\n    tokenDecode(token) {\n      if (token !== null) return jwtDecode(token);\n    },\n  },\n  created() {\n    this.dName = this.tokenDecode(getToken()).dName;\n    this.dId = this.tokenDecode(getToken()).dId;\n    this.oId = this.$route.query.oId;\n    this.pId = this.$route.query.pId;\n    this.requestPatient();\n    this.requestDrug();\n    this.requestCheck();\n  },\n};\n</script>"]}]}